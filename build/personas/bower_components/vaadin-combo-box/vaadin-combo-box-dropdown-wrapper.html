<html><head><link rel="import" href="../polymer/polymer-element.html"><link rel="import" href="../polymer/lib/utils/debounce.html"><link rel="import" href="../iron-list/iron-list.html"><link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html"><link rel="import" href="vaadin-combo-box-item.html"><link rel="import" href="vaadin-combo-box-dropdown.html"></head><body><dom-module id="vaadin-combo-box-dropdown-wrapper"><template><vaadin-combo-box-dropdown id="dropdown" opened="{{opened}}" hidden="[[_hidden(_items.*, loading)]]" position-target="[[positionTarget]]" vertical-offset="[[verticalOffset]]" on-template-changed="_templateChanged" on-position-changed="_setOverlayHeight"><template><style>:host([opened][loading]){display:block !important;height:58px;}#scroller{overflow:auto;transform:translate3d(0, 0, 0);-webkit-overflow-scrolling:touch;}#selector{--iron-list-items-container:{border-top:8px solid transparent;border-bottom:8px solid transparent;};}</style><div id="scroller" on-click="_stopPropagation" hidden$="[[loading]]"><iron-list id="selector" role="listbox" items="[[_items]]" scroll-target="[[_scroller]]"><template><vaadin-combo-box-item on-click="_onItemClick" index="[[index]]" item="[[item]]" label="[[getItemLabel(item)]]" selected="[[_isItemSelected(item, _selectedItem)]]" role$="[[_getAriaRole(index)]]" aria-selected$="[[_getAriaSelected(_focusedIndex,index)]]" focused="[[_isItemFocused(_focusedIndex,index)]]" touch-device$="[[touchDevice]]"></vaadin-combo-box-item></template></iron-list></div></template></vaadin-combo-box-dropdown></template></dom-module><script>{var ComboBoxOverlayElement=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}var c=Math.max;return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:'ready',value:function(){var a=this;babelHelpers.get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'ready',this).call(this),/Trident/.test(navigator.userAgent)&&this._scroller.setAttribute('unselectable','on'),this.$.dropdown.$.overlay.addEventListener('touchstart',function(b){var c=new CustomEvent('vaadin-overlay-touch-start',{detail:{sourceEvent:b}});a.dispatchEvent(c)}),this.$.dropdown.$.overlay.addEventListener('mousedown',function(a){return a.preventDefault()})}},{key:'_templateChanged',value:function(){this._selector=this.$.dropdown.$.overlay.$.content.querySelector('#selector'),this._scroller=this.$.dropdown.$.overlay.$.content.querySelector('#scroller')}},{key:'_loadingChanged',value:function(a){a?this.$.dropdown.$.overlay.setAttribute('loading',''):this.$.dropdown.$.overlay.removeAttribute('loading')}},{key:'_selectorChanged',value:function(){this._patchWheelOverScrolling()}},{key:'_setOverlayHeight',value:function(){if(this.positionTarget&&this._selector){var a=this.positionTarget.getBoundingClientRect();this._scroller.style.maxHeight=(window.ShadyCSS?window.ShadyCSS.getComputedStyleValue(this,'--vaadin-combo-box-overlay-max-height'):getComputedStyle(this).getPropertyValue('--vaadin-combo-box-overlay-max-height'))||'65vh',this.$.dropdown.$.overlay.style.maxHeight=this._maxOverlayHeight(a),this._selector.style.maxHeight=this._maxOverlayHeight(a),this.updateViewportBoundaries()}}},{key:'_maxOverlayHeight',value:function(a){var b=Math.min,d=8,e=116,f=b(window.innerHeight,document.body.scrollHeight-document.body.scrollTop);return this.$.dropdown.alignedAbove?c(a.top-d+b(document.body.scrollTop,0),e)+'px':c(f-a.bottom-d,e)+'px'}},{key:'_getFocusedItem',value:function(a){if(0<=a)return this._items[a]}},{key:'_isItemSelected',value:function(a,b){return a===b}},{key:'_onItemClick',value:function(a){a.detail&&a.detail.sourceEvent&&a.detail.sourceEvent.stopPropagation&&this._stopPropagation(a.detail.sourceEvent),this.dispatchEvent(new CustomEvent('selection-changed',{detail:{item:a.model.item}}))}},{key:'indexOfLabel',value:function(a){if(this._items&&a)for(var b=0;b<this._items.length;b++)if(this.getItemLabel(this._items[b]).toString().toLowerCase()===a.toString().toLowerCase())return b;return-1}},{key:'getItemLabel',value:function(a){var b=a?this.get(this._itemLabelPath,a):void 0;return void 0===b&&(b=a?a.toString():''),b}},{key:'_isItemFocused',value:function(a,b){return a==b}},{key:'_getAriaSelected',value:function(a,b){return this._isItemFocused(a,b).toString()}},{key:'_getAriaRole',value:function(a){return void 0!==a&&'option'}},{key:'_focusedIndexChanged',value:function(a){0<=a&&this._scrollIntoView(a)}},{key:'_scrollIntoView',value:function(a){var b=this._visibleItemsCount();if(void 0!==b){var d=a;a>this._selector.lastVisibleIndex-1?d=a-b+1:a>this._selector.firstVisibleIndex&&(d=this._selector.firstVisibleIndex),this._selector.scrollToIndex(c(0,d));var e=this._selector._getPhysicalIndex(a),f=this._selector._physicalItems[e];if(f){var g=f.getBoundingClientRect(),h=this._scroller.getBoundingClientRect(),i=g.bottom-h.bottom+this._viewportTotalPaddingBottom;0<i&&(this._scroller.scrollTop+=i)}}}},{key:'ensureItemsRendered',value:function(){this._selector._render()}},{key:'adjustScrollPosition',value:function(){this._items&&this._scrollIntoView(this._focusedIndex)}},{key:'_patchWheelOverScrolling',value:function(){var a=this._selector;a.addEventListener('wheel',function(b){var c=a._scroller||a.scrollTarget,d=0===c.scrollTop,e=1>=c.scrollHeight-c.scrollTop-c.clientHeight;d&&0>b.deltaY?b.preventDefault():e&&0<b.deltaY&&b.preventDefault()})}},{key:'updateViewportBoundaries',value:function(){this._cachedViewportTotalPaddingBottom=void 0,this._selector.updateViewportBoundaries()}},{key:'_visibleItemsCount',value:function(){if(this._selector)return this._selector.flushDebouncer('_debounceTemplate'),this._selector.scrollToIndex(this._selector.firstVisibleIndex),this.updateViewportBoundaries(),this._selector.lastVisibleIndex-this._selector.firstVisibleIndex+1}},{key:'_selectItem',value:function(a){a='number'===typeof a?this._items[a]:a,this._selector.selectedItem!==a&&this._selector.selectItem(a)}},{key:'_preventDefault',value:function(a){a.cancelable&&a.preventDefault()}},{key:'_stopPropagation',value:function(a){a.stopPropagation()}},{key:'_hidden',value:function(a,b){return!b&&(!this._items||!this._items.length)}},{key:'_viewportTotalPaddingBottom',get:function(){if(void 0===this._cachedViewportTotalPaddingBottom){var a=window.getComputedStyle(this._selector.$.items);this._cachedViewportTotalPaddingBottom=[a.paddingBottom,a.borderBottomWidth].map(function(a){return parseInt(a,10)}).reduce(function(a,b){return a+b})}return this._cachedViewportTotalPaddingBottom}}],[{key:'is',get:function(){return'vaadin-combo-box-dropdown-wrapper'}},{key:'properties',get:function(){return{touchDevice:{type:Boolean,reflectToAttribute:!0,value:function(){try{return document.createEvent('TouchEvent'),!0}catch(a){return!1}}},opened:Boolean,loading:{type:Boolean,value:!1,reflectToAttribute:!0,observer:'_setOverlayHeight'},verticalOffset:{type:Number,value:0},_selectedItem:{type:Object},_items:{type:Object},_focusedIndex:{type:Number,notify:!0,value:-1,observer:'_focusedIndexChanged'},_focusedItem:{type:String,computed:'_getFocusedItem(_focusedIndex)'},_itemLabelPath:{type:String,value:'label'},_itemValuePath:{type:String,value:'value'},_selector:Object}}},{key:'observers',get:function(){return['_selectorChanged(_selector)','_loadingChanged(loading)']}}]),b}(Polymer.Element);customElements.define(ComboBoxOverlayElement.is,ComboBoxOverlayElement),window.Vaadin=window.Vaadin||{},Vaadin.ComboBoxOverlayElement=ComboBoxOverlayElement}</script></body></html>