<html><head><link rel="import" href="../polymer/polymer-element.html"><link rel="import" href="../iron-a11y-announcer/iron-a11y-announcer.html"><script>window.Vaadin=window.Vaadin||{},Vaadin.ComboBoxMixin=function(a){return function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:'ready',value:function(){var a=this;babelHelpers.get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'ready',this).call(this),this.addEventListener('focusout',function(){a._closeOnBlurIsPrevented||a.close()}),this._lastCommittedValue=this.value,Polymer.IronA11yAnnouncer.requestAvailability(),this.$.overlay.addEventListener('selection-changed',this._overlaySelectedItemChanged.bind(this)),this.addEventListener('vaadin-combo-box-dropdown-closed',this._onClosed.bind(this)),this.addEventListener('vaadin-combo-box-dropdown-opened',this._onOpened.bind(this)),this.addEventListener('keydown',this._onKeyDown.bind(this)),this.addEventListener('click',this._onClick.bind(this)),this.$.overlay.addEventListener('vaadin-overlay-touch-start',this._onOverlayTouchStart.bind(this))}},{key:'open',value:function(){this.disabled||this.readonly||(this.opened=!0)}},{key:'close',value:function(){this.opened=!1}},{key:'_openedChanged',value:function(a,b){void 0!==b&&(!this.opened||this.$.overlay.touchDevice||this.focused||this.focus())}},{key:'_onOverlayTouchStart',value:function(){this._closeOnBlurIsPrevented=!0,this.inputElement.blur(),this._closeOnBlurIsPrevented=!1}},{key:'_onClick',value:function(a){this._closeOnBlurIsPrevented=!0;var b=a.composedPath();-1===b.indexOf(this._clearElement)?-1!==b.indexOf(this.inputElement)&&(-1<b.indexOf(this._toggleElement)&&this.opened?this.close():this.open()):this._clear(),this._closeOnBlurIsPrevented=!1}},{key:'_onKeyDown',value:function(a){this._isEventKey(a,'down')?(this._closeOnBlurIsPrevented=!0,this._onArrowDown(),this._closeOnBlurIsPrevented=!1,a.preventDefault()):this._isEventKey(a,'up')?(this._closeOnBlurIsPrevented=!0,this._onArrowUp(),this._closeOnBlurIsPrevented=!1,a.preventDefault()):this._isEventKey(a,'enter')?this._onEnter(a):this._isEventKey(a,'esc')&&this._onEscape(a)}},{key:'_isEventKey',value:function(a,b){return Polymer.IronA11yKeysBehavior.keyboardEventMatchesKeys(a,b)}},{key:'_getItemLabel',value:function(a){return this.$.overlay.getItemLabel(a)}},{key:'_getItemValue',value:function(a){var b=a?this.get(this.itemValuePath,a):void 0;return void 0===b&&(b=a?a.toString():''),b}},{key:'_onArrowDown',value:function(){this.opened?this.$.overlay._items&&(this._focusedIndex=Math.min(this.$.overlay._items.length-1,this._focusedIndex+1),this._prefillFocusedItemLabel()):this.open()}},{key:'_onArrowUp',value:function(){this.opened?(-1<this._focusedIndex?this._focusedIndex=Math.max(0,this._focusedIndex-1):this.$.overlay._items&&(this._focusedIndex=this.$.overlay._items.length-1),this._prefillFocusedItemLabel()):this.open()}},{key:'_prefillFocusedItemLabel',value:function(){var a=this;-1<this._focusedIndex&&(this._inputElementValue='',setTimeout(function(){a._inputElementValue=a._getItemLabel(a.$.overlay._focusedItem),a._markAllSelectionRange()},1))}},{key:'_setSelectionRange',value:function(a,b){var c=this._nativeInput||this.inputElement;if(this.focused&&c&&c.setSelectionRange)try{c.setSelectionRange(a,b)}catch(a){}}},{key:'_markAllSelectionRange',value:function(){void 0!==this._inputElementValue&&this._setSelectionRange(0,this._inputElementValue.length)}},{key:'_clearSelectionRange',value:function(){if(void 0!==this._inputElementValue){var a=this._inputElementValue?this._inputElementValue.length:0;this._setSelectionRange(a,a)}}},{key:'_onEnter',value:function(a){this.opened&&(this.allowCustomValue||''===this._inputElementValue||-1<this._focusedIndex)&&(this.close(),a.preventDefault())}},{key:'_onEscape',value:function(a){this.opened&&(this._stopPropagation(a),-1<this._focusedIndex?(this._focusedIndex=-1,this._revertInputValue()):this.cancel())}},{key:'_toggleElementChanged',value:function(a){a&&a.addEventListener('mousedown',function(a){return a.preventDefault()})}},{key:'_clear',value:function(){this.selectedItem=null,this.allowCustomValue&&(this.value=''),this.opened||(this._detectAndDispatchChange(),this.open())}},{key:'cancel',value:function(){this._revertInputValueToValue(),this._lastCommittedValue=this.value,this.close()}},{key:'_onOpened',value:function(){var a=this;Polymer.flush&&Polymer.flush(),this.$.overlay.ensureItemsRendered(),this.$.overlay.updateViewportBoundaries(),Polymer.Async.microTask.run(function(){return a.$.overlay.adjustScrollPosition()}),setTimeout(function(){return a.$.overlay.$.dropdown.notifyResize()},1),this._lastCommittedValue=this.value}},{key:'_onClosed',value:function(){if(this.opened&&this.close(),this.$.overlay._items&&-1<this._focusedIndex){var a=this.$.overlay._items[this._focusedIndex];this.selectedItem!==a&&(this.selectedItem=a),this._inputElementValue=this._getItemLabel(this.selectedItem)}else if(''===this._inputElementValue||void 0===this._inputElementValue)this.selectedItem=null,this.allowCustomValue&&(this.value='');else if(this.allowCustomValue){var b=new CustomEvent('custom-value-set',{detail:this._inputElementValue,composed:!0,cancelable:!0,bubbles:!0});if(this.dispatchEvent(b),!b.defaultPrevented){var c=this._inputElementValue;this.selectedItem=null,this.value=c}}else this._inputElementValue=this._getItemLabel(this.selectedItem);this._detectAndDispatchChange(),this._clearSelectionRange(),this.filter=''}},{key:'_inputValueChanged',value:function(a){-1!==a.composedPath().indexOf(this.inputElement)&&(this._inputElementValue=this.inputElement.value,this._filterFromInput())}},{key:'_filterFromInput',value:function(){this.opened||this.open(),this.filter===this._inputElementValue?this._filterChanged(this.filter,this.itemValuePath,this.itemLabelPath):this.filter=this._inputElementValue}},{key:'_filterChanged',value:function(a,b,c){void 0===a||void 0===b||void 0===c||(this.items?this.filteredItems=this._filterItems(this.items,a):this._filteredItemsChanged({path:'filteredItems'},b,c))}},{key:'_loadingChanged',value:function(a){a&&(this._focusedIndex=-1)}},{key:'_revertInputValue',value:function(){''===this.filter?this._revertInputValueToValue():this._inputElementValue=this.filter,this._clearSelectionRange()}},{key:'_revertInputValueToValue',value:function(){this._inputElementValue=this.allowCustomValue&&!this.selectedItem?this.value:this._getItemLabel(this.selectedItem)}},{key:'_selectedItemChanged',value:function(a){if(this.filteredItems){if(null===a||void 0===a)this.allowCustomValue||(this.value=''),this._setHasValue(''!==this.value),this._inputElementValue=this.value;else{var b=this._getItemValue(a);this.value!==b&&(this.value=b),this._setHasValue(!0),this._inputElementValue=this._getItemLabel(a),this.inputElement&&(this.inputElement.value=this._inputElementValue)}this.$.overlay._selectedItem=a,this._focusedIndex=this.filteredItems.indexOf(a)}}},{key:'_valueChanged',value:function(a,b){if(''!==a||void 0!==b){if(this._isValidValue(a)){var c;if(this._getItemValue(this.selectedItem)!==a){var d=this._indexOfValue(a,this.filteredItems);this.selectedItem=0<=d?this.filteredItems[d]:null}else c=this.selectedItem;!c&&this.allowCustomValue&&(this._inputElementValue=a),this._setHasValue(''!==this.value)}else this.selectedItem=null;this._lastCommittedValue=void 0}}},{key:'_detectAndDispatchChange',value:function(){this.value!==this._lastCommittedValue&&(this.dispatchEvent(new CustomEvent('change',{composed:!0,bubbles:!0})),this._lastCommittedValue=this.value)}},{key:'_itemsChanged',value:function(a,b,c){if(void 0!==a&&void 0!==b&&void 0!==c&&('items'===a.path||'items.splices'===a.path)){this.filteredItems=this.items?this.items.slice(0):this.items;var d=this._indexOfValue(this.value,this.items);this._focusedIndex=d;var e=-1<d&&this.items[d];e&&(this.selectedItem=e)}}},{key:'_filteredItemsChanged',value:function(a,b,c){var d=this;void 0===a||void 0===b||void 0===c||('filteredItems'===a.path||'filteredItems.splices'===a.path)&&(this._setOverlayItems(this.filteredItems),this._focusedIndex=this.opened?this.$.overlay.indexOfLabel(this.filter):this._indexOfValue(this.value,this.filteredItems),setTimeout(function(){d.$.overlay.$.dropdown.notifyResize()},1))}},{key:'_filterItems',value:function(a,b){var c=this;return a?a.filter(function(a){return b=b?b.toString().toLowerCase():'',-1<c._getItemLabel(a).toString().toLowerCase().indexOf(b)}):a}},{key:'_setOverlayItems',value:function(a){this.$.overlay.set('_items',a),this.$.overlay.$.dropdown.notifyResize()}},{key:'_indexOfValue',value:function(a,b){if(b&&this._isValidValue(a))for(var c=0;c<b.length;c++)if(this._getItemValue(b[c])===a)return c;return-1}},{key:'_isValidValue',value:function(a){return void 0!==a&&null!==a}},{key:'_overlaySelectedItemChanged',value:function(a){this.selectedItem!==a.detail.item&&(this.selectedItem=a.detail.item),this.opened&&this.close(),a.stopPropagation()}},{key:'validate',value:function(){return!(this.invalid=!this.checkValidity())}},{key:'checkValidity',value:function(){if(this._bindableInput.validate)return this._bindableInput.validate()}},{key:'_ensureTemplatized',value:function(){if(!this._TemplateClass){var a=this.querySelector('template');a&&(this._TemplateClass=Polymer.Templatize.templatize(a,this,{instanceProps:this._instanceProps,forwardHostProp:function(a,b){var c=this.$.overlay._selector.querySelectorAll('vaadin-combo-box-item');Array.prototype.forEach.call(c,function(c){c._itemTemplateInstance&&(c._itemTemplateInstance.set(a,b),c._itemTemplateInstance.notifyPath(a,b,!0))})}}))}}},{key:'_preventInputBlur',value:function(){this._toggleElement&&this._toggleElement.addEventListener('click',this._preventDefault),this._clearElement&&this._clearElement.addEventListener('click',this._preventDefault)}},{key:'_restoreInputBlur',value:function(){this._toggleElement&&this._toggleElement.removeEventListener('click',this._preventDefault),this._clearElement&&this._clearElement.removeEventListener('click',this._preventDefault)}},{key:'_preventDefault',value:function(a){a.preventDefault()}},{key:'_stopPropagation',value:function(a){a.stopPropagation()}},{key:'_instanceProps',get:function(){return{item:!0,index:!0,selected:!0,focused:!0}}}],[{key:'properties',get:function(){return{opened:{type:Boolean,notify:!0,value:!1,reflectToAttribute:!0,observer:'_openedChanged'},disabled:{type:Boolean,value:!1,reflectToAttribute:!0},readonly:{type:Boolean,value:!1,reflectToAttribute:!0},items:{type:Array},allowCustomValue:{type:Boolean,value:!1},filteredItems:{type:Array},value:{type:String,observer:'_valueChanged',notify:!0,value:''},_lastCommittedValue:String,hasValue:{type:Boolean,value:!1,readOnly:!0,reflectToAttribute:!0},loading:{type:Boolean,value:!1,reflectToAttribute:!0},_focusedIndex:{type:Number,value:-1},filter:{type:String,value:'',notify:!0},selectedItem:{type:Object,notify:!0},itemLabelPath:{type:String,value:'label'},itemValuePath:{type:String,value:'value'},name:{type:String},invalid:{type:Boolean,reflectToAttribute:!0,notify:!0,value:!1},_toggleElement:Object,_clearElement:Object,_inputElementValue:String,_closeOnBlurIsPrevented:Boolean,_previousDocumentPointerEvents:String}}},{key:'observers',get:function(){return['_filterChanged(filter, itemValuePath, itemLabelPath)','_itemsChanged(items.*, itemValuePath, itemLabelPath)','_filteredItemsChanged(filteredItems.*, itemValuePath, itemLabelPath)','_loadingChanged(loading)','_selectedItemChanged(selectedItem)','_toggleElementChanged(_toggleElement)']}}]),b}(a)};</script></head><body></body></html>