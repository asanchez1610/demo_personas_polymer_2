<html><head><link rel="import" href="../polymer/polymer-element.html"><link rel="import" href="../polymer/lib/mixins/gesture-event-listeners.html"><link rel="import" href="../iron-media-query/iron-media-query.html"><link rel="import" href="../iron-a11y-keys-behavior/iron-a11y-keys-behavior.html"><link rel="import" href="../iron-a11y-announcer/iron-a11y-announcer.html"><link rel="import" href="../vaadin-text-field/vaadin-text-field.html"><link rel="import" href="../vaadin-button/vaadin-button.html"><link rel="import" href="../vaadin-themable-mixin/vaadin-themable-mixin.html"><link rel="import" href="vaadin-month-calendar.html"><link rel="import" href="vaadin-infinite-scroller.html"><link rel="import" href="vaadin-date-picker-helper.html"><link rel="import" href="vaadin-date-picker-styles.html"></head><body><dom-module id="vaadin-date-picker-overlay"><template><style>:host{display:flex;flex-direction:column;height:100%;width:100%;outline:none;background:#fff;}[part="overlay-header"]{display:flex;flex-shrink:0;flex-wrap:nowrap;align-items:center;}:host(:not([fullscreen])) [part="overlay-header"]{display:none;}[part="label"]{flex-grow:1;}[part="clear-button"],
      [part="toggle-button"],
      [part="years-toggle-button"]::before{font-family:'vaadin-date-picker-icons';}[part="clear-button"]:not([showclear]){display:none;}[part="clear-button"]::before{content:"\e901";}[part="toggle-button"]::before{content:"\e902";}[part="years-toggle-button"]{display:flex;}[part="years-toggle-button"][desktop]{display:none;}[part="years-toggle-button"]::before{content:"\e900";}:host(:not([years-visible])) [part="years-toggle-button"]::before{transform:rotate(180deg);}#scrollers{display:flex;height:100%;width:100%;position:relative;overflow:hidden;}[part="months"],
      [part="years"]{height:100%;}[part="months"]{--vaadin-infinite-scroller-item-height:270px;position:absolute;top:0;left:0;right:0;bottom:0;}#scrollers[desktop] [part="months"]{right:50px;transform:none !important;}[part="years"]{--vaadin-infinite-scroller-item-height:80px;width:50px;position:absolute;right:0;transform:translateX(100%);-webkit-tap-highlight-color:transparent;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;--vaadin-infinite-scroller-buffer-offset:50%;}#scrollers[desktop] [part="years"]{position:absolute;transform:none !important;}[part="years"]::before{content:'';display:block;background:transparent;width:0;height:0;position:absolute;left:0;top:50%;transform:translateY(-50%);border-width:6px;border-style:solid;border-color:transparent;border-left-color:#000;}:host(.animate) [part="months"],
      :host(.animate) [part="years"]{transition:all 200ms;}[part="toolbar"]{display:flex;justify-content:space-between;z-index:2;flex-shrink:0;}[part~="overlay-header"]:not([desktop]){padding-bottom:40px;}[part~="years-toggle-button"]{position:absolute;top:auto;right:8px;bottom:0;z-index:1;padding:8px;}#announcer{display:inline-block;position:fixed;clip:rect(0, 0, 0, 0);clip-path:inset(100%);}</style><div id="announcer" role="alert" aria-live="polite">[[i18n.calendar]]</div><div part="overlay-header" on-touchend="_preventDefault" desktop$="[[_desktopMode]]" aria-hidden="true"><div part="label">[[_formatDisplayed(selectedDate, i18n.formatDate, label)]]</div><div part="clear-button" on-tap="_clear" showclear$="[[_showClear(selectedDate)]]"></div><div part="toggle-button" on-tap="_cancel"></div><div part="years-toggle-button" desktop$="[[_desktopMode]]" on-tap="_toggleYearScroller" aria-hidden="true">[[_yearAfterXMonths(_visibleMonthIndex)]]</div></div><div id="scrollers" desktop$="[[_desktopMode]]" on-track="_track"><vaadin-infinite-scroller id="monthScroller" on-custom-scroll="_onMonthScroll" on-touchstart="_onMonthScrollTouchStart" buffer-size="6" active="[[initialPosition]]" part="months"><template><vaadin-month-calendar i18n="[[i18n]]" month="[[_dateAfterXMonths(index)]]" selected-date="{{selectedDate}}" focused-date="[[focusedDate]]" ignore-taps="[[_ignoreTaps]]" show-week-numbers="[[showWeekNumbers]]" min-date="[[minDate]]" max-date="[[maxDate]]" focused$="[[_focused]]" part="month"></vaadin-month-calendar></template></vaadin-infinite-scroller><vaadin-infinite-scroller id="yearScroller" on-tap="_onYearTap" on-custom-scroll="_onYearScroll" on-touchstart="_onYearScrollTouchStart" buffer-size="25" active="[[initialPosition]]" part="years"><template><div part="year-number" role="button" current$="[[_isCurrentYear(index)]]" selected$="[[_isSelectedYear(index, selectedDate)]]">[[_yearAfterXYears(index)]]</div><div part="year-separator" aria-hidden="true"></div></template></vaadin-infinite-scroller></div><div on-touchend="_preventDefault" role="toolbar" part="toolbar"><vaadin-button id="todayButton" part="today-button" disabled="[[!_isTodayAllowed(minDate, maxDate)]]" on-tap="_onTodayTap">[[i18n.today]]</vaadin-button><vaadin-button id="cancelButton" part="cancel-button" on-tap="_cancel">[[i18n.cancel]]</vaadin-button></div><iron-media-query query="(min-width: 375px)" query-matches="{{_desktopMode}}"></iron-media-query></template><script>{var DatePickerOverlayElement=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}var c=Math.floor;return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:'ready',value:function(){babelHelpers.get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'ready',this).call(this),this.setAttribute('tabindex',0),this.addEventListener('keydown',this._onKeydown.bind(this)),this.addEventListener('tap',this._stopPropagation.bind(this)),this.addEventListener('focus',this._onOverlayFocus.bind(this)),this.addEventListener('blur',this._onOverlayBlur.bind(this))}},{key:'connectedCallback',value:function(){babelHelpers.get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'connectedCallback',this).call(this),this._translateX=this._yearScrollerWidth,this._toggleAnimateClass(!0),Polymer.Gestures.setTouchAction(this.$.scrollers,'pan-y'),Polymer.IronA11yAnnouncer.requestAvailability()}},{key:'announceFocusedDate',value:function(){var a=this._currentlyFocusedDate(),b=[];return Vaadin.DatePickerHelper._dateEquals(a,new Date)&&b.push(this.i18n.today),b=b.concat([this.i18n.weekdays[a.getDay()],a.getDate(),this.i18n.monthNames[a.getMonth()],a.getFullYear()]),this.showWeekNumbers&&1===this.i18n.firstDayOfWeek&&(b.push(this.i18n.week),b.push(Vaadin.DatePickerHelper._getISOWeekNumber(a))),void this.dispatchEvent(new CustomEvent('iron-announce',{bubbles:!0,composed:!0,detail:{text:b.join(' ')}}))}},{key:'focusCancel',value:function(){this.$.cancelButton.focus()}},{key:'scrollToDate',value:function(a,b){this._scrollToPosition(this._differenceInMonths(a,this._originDate),b)}},{key:'_focusedDateChanged',value:function(a){this.revealDate(a)}},{key:'_isCurrentYear',value:function(a){return 0===a}},{key:'_isSelectedYear',value:function(a,b){if(b)return b.getFullYear()===this._originDate.getFullYear()+a}},{key:'revealDate',value:function(a){if(a){var b=this._differenceInMonths(a,this._originDate),c=this.$.monthScroller.position>b,d=this.$.monthScroller.clientHeight/this.$.monthScroller.itemHeight,e=this.$.monthScroller.position+d-1<b;c?this._scrollToPosition(b,!0):e&&this._scrollToPosition(b-d+1,!0)}}},{key:'_onOverlayFocus',value:function(){this._focused=!0}},{key:'_onOverlayBlur',value:function(){this._focused=!1}},{key:'_initialPositionChanged',value:function(a){this.scrollToDate(a)}},{key:'_repositionYearScroller',value:function(){this._visibleMonthIndex=c(this.$.monthScroller.position),this.$.yearScroller.position=(this.$.monthScroller.position+this._originDate.getMonth())/12}},{key:'_repositionMonthScroller',value:function(){this.$.monthScroller.position=12*this.$.yearScroller.position-this._originDate.getMonth(),this._visibleMonthIndex=c(this.$.monthScroller.position)}},{key:'_onMonthScroll',value:function(){this._repositionYearScroller(),this._doIgnoreTaps()}},{key:'_onYearScroll',value:function(){this._repositionMonthScroller(),this._doIgnoreTaps()}},{key:'_onYearScrollTouchStart',value:function(){var a=this;this._notTapping=!1,setTimeout(function(){return a._notTapping=!0},300),this._repositionMonthScroller()}},{key:'_onMonthScrollTouchStart',value:function(){this._repositionYearScroller()}},{key:'_doIgnoreTaps',value:function(){var a=this;this._ignoreTaps=!0,this._debouncer=Polymer.Debouncer.debounce(this._debouncer,Polymer.Async.timeOut.after(300),function(){return a._ignoreTaps=!1})}},{key:'_formatDisplayed',value:function(a,b,c){return a?b(a):c}},{key:'_onTodayTap',value:function(){var a=new Date;this.$.monthScroller.position===this._differenceInMonths(a,this._originDate)?(this.selectedDate=a,this._close()):this._scrollToCurrentMonth()}},{key:'_scrollToCurrentMonth',value:function(){this.focusedDate&&(this.focusedDate=new Date),this.scrollToDate(new Date,!0)}},{key:'_showClear',value:function(a){return!!a}},{key:'_onYearTap',value:function(a){if(!this._ignoreTaps&&!this._notTapping){var b=a.detail.y-(this.$.yearScroller.getBoundingClientRect().top+this.$.yearScroller.clientHeight/2),c=b/this.$.yearScroller.itemHeight;this._scrollToPosition(this.$.monthScroller.position+12*c,!0)}}},{key:'_scrollToPosition',value:function(a,b){var c=this;if(void 0!==this._targetPosition)return void(this._targetPosition=a);if(!b)return this.$.monthScroller.position=a,this._targetPosition=void 0,void this._repositionYearScroller();this._targetPosition=a;var d=function(a,e,b,f){return(a/=f/2,1>a)?b/2*a*a+e:(a--,-b/2*(a*(a-2)-1)+e)},e=b?300:0,f=0,g=this.$.monthScroller.position;window.requestAnimationFrame(function a(b){f=f||b;var h=b-f;if(h<e){var i=d(h,g,c._targetPosition-g,e);c.$.monthScroller.position=i,window.requestAnimationFrame(a)}else c.dispatchEvent(new CustomEvent('scroll-animation-finished',{bubbles:!0,composed:!0,detail:{position:c._targetPosition,oldPosition:g}})),c.$.monthScroller.position=c._targetPosition,c._targetPosition=void 0;setTimeout(c._repositionYearScroller.bind(c),1)})}},{key:'_limit',value:function(a,b){return Math.min(b.max,Math.max(b.min,a))}},{key:'_handleTrack',value:function(a){var b=Math.abs;if(!(10>b(a.detail.dx)||10<b(a.detail.ddy))){b(a.detail.ddx)>this._yearScrollerWidth/3&&this._toggleAnimateClass(!0);var c=this._translateX+a.detail.ddx;this._translateX=this._limit(c,{min:0,max:this._yearScrollerWidth})}}},{key:'_track',value:function(a){if(!this._desktopMode)switch(a.detail.state){case'start':this._toggleAnimateClass(!1);break;case'track':this._handleTrack(a);break;case'end':this._toggleAnimateClass(!0),this._translateX>=this._yearScrollerWidth/2?this._closeYearScroller():this._openYearScroller();}}},{key:'_toggleAnimateClass',value:function(a){a?this.classList.add('animate'):this.classList.remove('animate')}},{key:'_toggleYearScroller',value:function(){this._isYearScrollerVisible()?this._closeYearScroller():this._openYearScroller()}},{key:'_openYearScroller',value:function(){this._translateX=0,this.setAttribute('years-visible','')}},{key:'_closeYearScroller',value:function(){this.removeAttribute('years-visible'),this._translateX=this._yearScrollerWidth}},{key:'_isYearScrollerVisible',value:function(){return this._translateX<this._yearScrollerWidth/2}},{key:'_translateXChanged',value:function(a){this._desktopMode||(this.$.monthScroller.style.transform='translateX('+(a-this._yearScrollerWidth)+'px)',this.$.yearScroller.style.transform='translateX('+a+'px)')}},{key:'_yearAfterXYears',value:function(a){var b=new Date(this._originDate);return b.setFullYear(parseInt(a)+this._originDate.getFullYear()),b.getFullYear()}},{key:'_yearAfterXMonths',value:function(a){return this._dateAfterXMonths(a).getFullYear()}},{key:'_dateAfterXMonths',value:function(a){var b=new Date(this._originDate);return b.setDate(1),b.setMonth(parseInt(a)+this._originDate.getMonth()),b}},{key:'_differenceInMonths',value:function(a,b){var c=12*(a.getFullYear()-b.getFullYear());return c-b.getMonth()+a.getMonth()}},{key:'_differenceInYears',value:function(a,b){return this._differenceInMonths(a,b)/12}},{key:'_clear',value:function(){this.selectedDate='',this._close()}},{key:'_close',value:function(){this.dispatchEvent(new CustomEvent('close',{bubbles:!0,composed:!0}))}},{key:'_cancel',value:function(){this.focusedDate=this.selectedDate,this._close()}},{key:'_preventDefault',value:function(a){a.preventDefault()}},{key:'_eventKey',value:function(a){for(var b,c=['down','up','right','left','enter','space','home','end','pageup','pagedown','tab'],d=0;d<c.length;d++)if(b=c[d],Polymer.IronA11yKeysBehavior.keyboardEventMatchesKeys(a,b))return b}},{key:'_onKeydown',value:function(a){var b=this,c=this._currentlyFocusedDate(),d=0<=a.composedPath().indexOf(this.$.todayButton),e=0<=a.composedPath().indexOf(this.$.cancelButton),f=!d&&!e,g=this._eventKey(a);if('tab'===g){a.stopPropagation();var h=this.hasAttribute('fullscreen'),i=a.shiftKey;h?a.preventDefault():i&&f||!i&&e?(a.preventDefault(),this.dispatchEvent(new CustomEvent('focus-input',{bubbles:!0,composed:!0}))):i&&d?(this._focused=!0,setTimeout(function(){return b.revealDate(b.focusedDate)},1)):this._focused=!1}else if(g)switch(a.preventDefault(),a.stopPropagation(),g){case'down':this._moveFocusByDays(7),this.focus();break;case'up':this._moveFocusByDays(-7),this.focus();break;case'right':f&&this._moveFocusByDays(1);break;case'left':f&&this._moveFocusByDays(-1);break;case'enter':f||e?this._close():d&&this._onTodayTap();break;case'space':if(e)this._close();else if(d)this._onTodayTap();else{var j=this.focusedDate;Vaadin.DatePickerHelper._dateEquals(j,this.selectedDate)?(this.selectedDate='',this.focusedDate=j):this.selectedDate=j}break;case'home':this._moveFocusInsideMonth(c,'minDate');break;case'end':this._moveFocusInsideMonth(c,'maxDate');break;case'pagedown':this._moveFocusByMonths(a.shiftKey?12:1);break;case'pageup':this._moveFocusByMonths(a.shiftKey?-12:-1);}}},{key:'_currentlyFocusedDate',value:function(){return this.focusedDate||this.selectedDate||this.initialPosition||new Date}},{key:'_moveFocusByDays',value:function(a){var b=this._currentlyFocusedDate(),c=new Date(0,0);c.setFullYear(b.getFullYear()),c.setMonth(b.getMonth()),c.setDate(b.getDate()+a),this._dateAllowed(c,this.minDate,this.maxDate)?(this.focusedDate=c,this._focusedMonthDate=this.focusedDate.getDate()):this._dateAllowed(b,this.minDate,this.maxDate)?0<a?(this.focusedDate=this.maxDate,this._focusedMonthDate=this.maxDate.getDate()):(this.focusedDate=this.minDate,this._focusedMonthDate=this.minDate.getDate()):(this.focusedDate=Vaadin.DatePickerHelper._getClosestDate(b,[this.minDate,this.maxDate]),this._focusedMonthDate=this.focusedDate.getDate())}},{key:'_moveFocusByMonths',value:function(a){var b=this._currentlyFocusedDate(),c=new Date(0,0);c.setFullYear(b.getFullYear()),c.setMonth(b.getMonth()+a);var d=c.getMonth();c.setDate(this._focusedMonthDate||(this._focusedMonthDate=b.getDate())),c.getMonth()!==d&&c.setDate(0),this._dateAllowed(c,this.minDate,this.maxDate)?this.focusedDate=c:this._dateAllowed(b,this.minDate,this.maxDate)?0<a?(this.focusedDate=this.maxDate,this._focusedMonthDate=this.maxDate.getDate()):(this.focusedDate=this.minDate,this._focusedMonthDate=this.minDate.getDate()):(this.focusedDate=Vaadin.DatePickerHelper._getClosestDate(b,[this.minDate,this.maxDate]),this._focusedMonthDate=this.focusedDate.getDate())}},{key:'_moveFocusInsideMonth',value:function(a,b){var c=new Date(0,0);c.setFullYear(a.getFullYear()),'minDate'===b?(c.setMonth(a.getMonth()),c.setDate(1)):(c.setMonth(a.getMonth()+1),c.setDate(0)),this._dateAllowed(c,this.minDate,this.maxDate)?(this.focusedDate=c,this._focusedMonthDate=this.focusedDate.getDate()):this._dateAllowed(a,this.minDate,this.maxDate)?(this.focusedDate=this[b],this._focusedMonthDate=this[b].getDate()):(this.focusedDate=Vaadin.DatePickerHelper._getClosestDate(a,[this.minDate,this.maxDate]),this._focusedMonthDate=this.focusedDate.getDate())}},{key:'_dateAllowed',value:function(a,b,c){return(!b||a>=b)&&(!c||a<=c)}},{key:'_isTodayAllowed',value:function(a,b){var c=new Date,d=new Date(0,0);return d.setFullYear(c.getFullYear()),d.setMonth(c.getMonth()),d.setDate(c.getDate()),this._dateAllowed(d,a,b)}},{key:'_stopPropagation',value:function(a){a.stopPropagation()}}],[{key:'is',get:function(){return'vaadin-date-picker-overlay'}},{key:'properties',get:function(){return{selectedDate:{type:Date,notify:!0},focusedDate:{type:Date,notify:!0,observer:'_focusedDateChanged'},_focusedMonthDate:Number,initialPosition:{type:Date,observer:'_initialPositionChanged'},_originDate:{value:new Date},_visibleMonthIndex:Number,_desktopMode:Boolean,_translateX:{observer:'_translateXChanged'},_yearScrollerWidth:{value:50},i18n:{type:Object},showWeekNumbers:{type:Boolean},_ignoreTaps:Boolean,_notTapping:Boolean,minDate:Date,maxDate:Date,_focused:Boolean,label:String}}}]),b}(Vaadin.ThemableMixin(Polymer.GestureEventListeners(Polymer.Element)));customElements.define(DatePickerOverlayElement.is,DatePickerOverlayElement),window.Vaadin=window.Vaadin||{},Vaadin.DatePickerOverlayElement=DatePickerOverlayElement}</script></dom-module></body></html>