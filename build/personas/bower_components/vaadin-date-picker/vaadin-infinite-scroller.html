<html><head><link rel="import" href="../polymer/polymer-element.html"><link rel="import" href="../polymer/lib/legacy/class.html"><link rel="import" href="../polymer/lib/legacy/templatizer-behavior.html"></head><body><dom-module id="vaadin-infinite-scroller"><template><style>:host{display:block;overflow:hidden;height:500px;}#scroller{position:relative;height:100%;overflow:auto;outline:none;margin-right:-40px;-webkit-overflow-scrolling:touch;-ms-overflow-style:none;overflow-x:hidden;}#scroller.notouchscroll{-webkit-overflow-scrolling:auto;}#scroller::-webkit-scrollbar{display:none;}.buffer{position:absolute;width:var(--vaadin-infinite-scroller-buffer-width, 100%);box-sizing:border-box;padding-right:40px;top:var(--vaadin-infinite-scroller-buffer-offset, 0);animation:fadein 0.2s;}@keyframes fadein{from{opacity:0;}to{opacity:1;}}</style><div id="scroller" on-scroll="_scroll"><div class="buffer"></div><div class="buffer"></div><div id="fullHeight"></div></div></template></dom-module><script>{var InfiniteScrollerElement=function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:'ready',value:function(){babelHelpers.get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'ready',this).call(this),this._buffers=Array.prototype.slice.call(this.root.querySelectorAll('.buffer')),this.$.fullHeight.style.height=2*this._initialScroll+'px';var a=this.querySelector('template');this._TemplateClass=Polymer.Templatize.templatize(a,this,{forwardHostProp:function(a,b){'index'!==a&&this._buffers.forEach(function(c){[].forEach.call(c.children,function(c){c._itemWrapper.instance[a]=b})})}});var c=-1<navigator.userAgent.toLowerCase().indexOf('firefox');c&&(this.$.scroller.tabIndex=-1)}},{key:'_activated',value:function(a){a&&!this._initialized&&(this._createPool(),this._initialized=!0)}},{key:'_finishInit',value:function(){var a=this;this._initDone||(this._buffers.forEach(function(b){[].forEach.call(b.children,function(b){return a._ensureStampedInstance(b._itemWrapper)})},this),!this._buffers[0].translateY&&this._reset(),this._initDone=!0)}},{key:'_translateBuffer',value:function(a){var b=a?1:0;this._buffers[b].translateY=this._buffers[b?0:1].translateY+this._bufferHeight*(b?-1:1),this._buffers[b].style.transform='translate3d(0, '+this._buffers[b].translateY+'px, 0)',this._buffers[b].updated=!1,this._buffers.reverse()}},{key:'_scroll',value:function(){var a=this;if(!this._scrollDisabled){var b=this.$.scroller.scrollTop;(b<this._bufferHeight||b>2*this._initialScroll-this._bufferHeight)&&(this._initialIndex=~~this.position,this._reset());var c=this.root.querySelector('.buffer').offsetTop,d=b>this._buffers[1].translateY+this.itemHeight+c,e=b<this._buffers[0].translateY+this.itemHeight+c;(d||e)&&(this._translateBuffer(e),this._updateClones()),this._preventScrollEvent||(this.dispatchEvent(new CustomEvent('custom-scroll',{bubbles:!1,composed:!0})),this._mayHaveMomentum=!0),this._preventScrollEvent=!1,this._debouncerScrollFinish=Polymer.Debouncer.debounce(this._debouncerScrollFinish,Polymer.Async.timeOut.after(200),function(){var b=a.$.scroller.getBoundingClientRect();a._isVisible(a._buffers[0],b)||a._isVisible(a._buffers[1],b)||(a.position=a.position)})}}},{key:'_reset',value:function(){var a=this;this._scrollDisabled=!0,this.$.scroller.scrollTop=this._initialScroll,this._buffers[0].translateY=this._initialScroll-this._bufferHeight,this._buffers[1].translateY=this._initialScroll,this._buffers.forEach(function(a){a.style.transform='translate3d(0, '+a.translateY+'px, 0)'}),this._buffers[0].updated=this._buffers[1].updated=!1,this._updateClones(!0),this._debouncerUpdateClones=Polymer.Debouncer.debounce(this._debouncerUpdateClones,Polymer.Async.timeOut.after(200),function(){a._buffers[0].updated=a._buffers[1].updated=!1,a._updateClones()}),this._scrollDisabled=!1}},{key:'_createPool',value:function(){var a=this,b=this.getBoundingClientRect();this._buffers.forEach(function(c){for(var d=function(){var d=document.createElement('div');d.style.height=a.itemHeight+'px',d.instance={};var e=Vaadin.InfiniteScrollerElement._contentIndex=Vaadin.InfiniteScrollerElement._contentIndex+1||0,f='vaadin-infinite-scroller-item-content-'+e,g=document.createElement('slot');g.setAttribute('name',f),g._itemWrapper=d,c.appendChild(g),d.setAttribute('slot',f),a.appendChild(d),Polymer.dom.flush(),setTimeout(function(){a._isVisible(d,b)&&a._ensureStampedInstance(d)},1)},e=0;e<a.bufferSize;e++)d()},this),setTimeout(function(){Polymer.RenderStatus.afterNextRender(a,a._finishInit.bind(a))},1)}},{key:'_ensureStampedInstance',value:function(a){if(!a.firstElementChild){var b=a.instance;a.instance=new this._TemplateClass({}),a.appendChild(a.instance.root),Object.keys(b).forEach(function(c){a.instance.set(c,b[c])})}}},{key:'_updateClones',value:function(a){var b=this;this._firstIndex=~~((this._buffers[0].translateY-this._initialScroll)/this.itemHeight)+this._initialIndex;var c=a?this.$.scroller.getBoundingClientRect():void 0;this._buffers.forEach(function(d,e){if(!d.updated){var f=b._firstIndex+b.bufferSize*e;[].forEach.call(d.children,function(d,e){var g=d._itemWrapper;(!a||b._isVisible(g,c))&&(g.instance.index=f+e)}),d.updated=!0}},this)}},{key:'_isVisible',value:function(a,b){var c=a.getBoundingClientRect();return c.bottom>b.top&&c.top<b.bottom}},{key:'position',set:function(a){var b=this;this._preventScrollEvent=!0,a>this._firstIndex&&a<this._firstIndex+2*this.bufferSize?this.$.scroller.scrollTop=this.itemHeight*(a-this._firstIndex)+this._buffers[0].translateY:(this._initialIndex=~~a,this._reset(),this._scrollDisabled=!0,this.$.scroller.scrollTop+=a%1*this.itemHeight,this._scrollDisabled=!1),this._mayHaveMomentum&&(this.$.scroller.classList.add('notouchscroll'),this._mayHaveMomentum=!1,setTimeout(function(){b.$.scroller.classList.remove('notouchscroll')},10))},get:function(){return(this.$.scroller.scrollTop-this._buffers[0].translateY)/this.itemHeight+this._firstIndex}},{key:'itemHeight',get:function(){if(!this._itemHeightVal){var a=window.ShadyCSS?window.ShadyCSS.getComputedStyleValue(this,'--vaadin-infinite-scroller-item-height'):getComputedStyle(this).getPropertyValue('--vaadin-infinite-scroller-item-height');this._itemHeightVal=parseInt(a)}return this._itemHeightVal}},{key:'_bufferHeight',get:function(){return this.itemHeight*this.bufferSize}}],[{key:'is',get:function(){return'vaadin-infinite-scroller'}},{key:'properties',get:function(){return{bufferSize:{type:Number,value:20},_initialScroll:{value:5e5},_initialIndex:{value:0},_buffers:Array,_preventScrollEvent:Boolean,_mayHaveMomentum:Boolean,_initialized:Boolean,active:{type:Boolean,observer:'_activated'}}}}]),b}(Polymer.Element);customElements.define(InfiniteScrollerElement.is,InfiniteScrollerElement),window.Vaadin=window.Vaadin||{},Vaadin.InfiniteScrollerElement=InfiniteScrollerElement}</script></body></html>