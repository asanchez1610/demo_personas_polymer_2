<html><head><link rel="import" href="../polymer/lib/mixins/gesture-event-listeners.html"><script>window.Vaadin=window.Vaadin||{},window.Vaadin.Grid=window.Vaadin.Grid||{},Vaadin.Grid.ColumnReorderingMixin=function(a){return function(a){function b(){return babelHelpers.classCallCheck(this,b),babelHelpers.possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return babelHelpers.inherits(b,a),babelHelpers.createClass(b,[{key:'ready',value:function(){babelHelpers.get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),'ready',this).call(this),Polymer.Gestures.addListener(this,'track',this._onTrackEvent),this._reorderGhost=this.$$('[part="reorder-ghost"]'),this.addEventListener('touchstart',this._onTouchStart.bind(this)),this.addEventListener('touchmove',this._onTouchMove.bind(this)),this.addEventListener('touchend',this._onTouchEnd.bind(this)),this.addEventListener('contextmenu',this._onContextMenu.bind(this))}},{key:'_onContextMenu',value:function(a){this.hasAttribute('reordering')&&a.preventDefault()}},{key:'_onTouchStart',value:function(a){var b=this;this._startTouchReorderTimeout=setTimeout(function(){b._onTrackStart({detail:{x:a.touches[0].clientX,y:a.touches[0].clientY}})},100)}},{key:'_onTouchMove',value:function(a){this._draggedColumn&&a.preventDefault(),clearTimeout(this._startTouchReorderTimeout)}},{key:'_onTouchEnd',value:function(){clearTimeout(this._startTouchReorderTimeout),this._onTrackEnd()}},{key:'_onTrackEvent',value:function(a){if('start'===a.detail.state){var b=a.composedPath(),c=b[b.indexOf(this.$.header)-2];if(!c||!c._content)return;var d=this.getRootNode().activeElement;if(c._content.contains(this.getRootNode().activeElement)&&(!this._ie||!this._isFocusable(d)))return;if(this.$.scroller.hasAttribute('column-resizing'))return;this._touchDevice||this._onTrackStart(a)}else'track'===a.detail.state?this._onTrack(a):'end'===a.detail.state&&this._onTrackEnd(a)}},{key:'_onTrackStart',value:function(a){if(this.columnReorderingAllowed){var b=a.path||Polymer.dom(a).path;if(!(b&&b.filter(function(a){return a.hasAttribute&&a.hasAttribute('draggable')})[0])){var c=this._cellFromPoint(a.detail.x,a.detail.y);c&&-1!==c.getAttribute('part').indexOf('header-cell')&&(this.setAttribute('reordering',''),this._draggedColumn=c._column,this._setSiblingsReorderStatus(this._draggedColumn,'allowed'),this._draggedColumn._reorderStatus='dragging',this._updateGhost(c),this._reorderGhost.style.visibility='visible',this._updateGhostPosition(a.detail.x,this._touchDevice?a.detail.y-50:a.detail.y),this._autoScroller())}}}},{key:'_onTrack',value:function(a){if(this._draggedColumn){var b=this._cellFromPoint(a.detail.x,a.detail.y);if(b){var c=this._getTargetColumn(b,this._draggedColumn);this._isSwapAllowed(this._draggedColumn,c)&&this._isSwappableByPosition(c,a.detail.x)&&this._swapColumnOrders(this._draggedColumn,c),this._updateGhostPosition(a.detail.x,this._touchDevice?a.detail.y-50:a.detail.y),this._lastDragClientX=a.detail.x}}}},{key:'_onTrackEnd',value:function(){this._draggedColumn&&(this.removeAttribute('reordering'),this._draggedColumn._reorderStatus='',this._setSiblingsReorderStatus(this._draggedColumn,''),this._draggedColumn=null,this._lastDragClientX=null,this._reorderGhost.style.visibility='hidden')}},{key:'_cellFromPoint',value:function(a,b){a=a||0,b=b||0,this._draggedColumn||this.$.scroller.setAttribute('no-content-pointer-events','');var c;if(c=Polymer.Settings.useShadow?this.shadowRoot.elementFromPoint(a,b):document.elementFromPoint(a,b),this.$.scroller.removeAttribute('no-content-pointer-events',''),c&&c._column)return c}},{key:'_updateGhostPosition',value:function(a,b){var c=this._reorderGhost.getBoundingClientRect(),d=a-c.width/2,e=b-c.height/2,f=parseInt(this._reorderGhost._left||0),g=parseInt(this._reorderGhost._top||0);this._reorderGhost._left=f-(c.left-d),this._reorderGhost._top=g-(c.top-e),this._reorderGhost.style.transform='translate('+this._reorderGhost._left+'px, '+this._reorderGhost._top+'px)'}},{key:'_updateGhost',value:function(a){var b=this._reorderGhost;b.textContent=a._content.innerText;var c=window.getComputedStyle(a);return['boxSizing','display','width','height','background','alignItems','padding','border','flex-direction','overflow'].forEach(function(a){return b.style[a]=c[a]}),b}},{key:'_updateOrders',value:function(a,b){var c=this;void 0===a||void 0===b||a[0].forEach(function(a,b){return a._order=(b+1)*c._orderBaseScope})}},{key:'_setSiblingsReorderStatus',value:function(a,b){var c=this;Array.from(a.parentNode.children).filter(function(b){return /column/.test(b.localName)&&c._isSwapAllowed(b,a)}).forEach(function(a){return a._reorderStatus=b})}},{key:'_autoScroller',value:function(){if(this._lastDragClientX){var a=this._lastDragClientX-this.getBoundingClientRect().right+50,b=this.getBoundingClientRect().left-this._lastDragClientX+50;0<a?this.$.table.scrollLeft+=a/10:0<b&&(this.$.table.scrollLeft-=b/10),this._scrollHandler()}this._draggedColumn&&this.async(this._autoScroller,10)}},{key:'_isSwapAllowed',value:function(a,b){if(a&&b){var c=a.parentElement===b.parentElement,d=a.frozen===b.frozen;return a!==b&&c&&d}}},{key:'_isSwappableByPosition',value:function(a,b){var c=Array.prototype.filter.call(this.$.header.querySelectorAll('[part~="cell"]'),function(b){return b._column===a})[0],d=this.$.header.querySelector('[reorder-status=dragging]').getBoundingClientRect(),e=c.getBoundingClientRect();return e.left>d.left?b>e.right-d.width:b<e.left+d.width}},{key:'_swapColumnOrders',value:function(a,b){var c=a._order;a._order=b._order,b._order=c,this._updateLastFrozen(),this._updateLastColumn()}},{key:'_getTargetColumn',value:function(a,b){if(a&&b){for(var c=a._column;c.parentElement!==b.parentElement&&c!==this;)c=c.parentElement;return c.parentElement===b.parentElement?c:a._column}}}],[{key:'properties',get:function(){return{columnReorderingAllowed:{type:Boolean,value:!1},_orderBaseScope:{type:Number,value:1e7},_touchDevice:{value:function(){try{return document.createEvent('TouchEvent'),!0}catch(a){return!1}}}}}},{key:'observers',get:function(){return['_updateOrders(_columnTree, _columnTree.*)']}}]),b}(Polymer.GestureEventListeners(a))};</script></head><body></body></html>