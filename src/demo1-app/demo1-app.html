<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/vaadin-valo-theme/vaadin-combo-box.html">
<link rel="import" href="../../bower_components/vaadin-combo-box/vaadin-combo-box.html">
<link rel="import" href="../../bower_components/granite-bootstrap/granite-bootstrap.html">

<link rel="import" href="../../bower_components/vaadin-valo-theme/vaadin-text-field.html">
<link rel="import" href="../../bower_components/vaadin-text-field/vaadin-text-field.html">

<link rel="import" href="../../bower_components/vaadin-valo-theme/vaadin-date-picker.html">
<link rel="import" href="../../bower_components/vaadin-date-picker/vaadin-date-picker.html">

<link rel="import" href="../../bower_components/vaadin-button/vaadin-button.html">

<link rel="import" href="../../bower_components/vaadin-valo-theme/vaadin-grid.html">
<link rel="import" href="../../bower_components/vaadin-grid/vaadin-grid.html">
<link rel="import" href="../../bower_components/vaadin-grid/vaadin-grid-sorter.html">
<link rel="import" href="../../bower_components/vaadin-grid/vaadin-grid-column.html">
<link rel="import" href="../../bower_components/vaadin-grid/vaadin-grid-selection-column.html">
<link rel="import" href="../../bower_components/vaadin-valo-theme/vaadin-progress-bar.html">
<link rel="import" href="../../bower_components/vaadin-progress-bar/vaadin-progress-bar.html">
<script src = "../../bower_components/moment/moment.js"></script>

<dom-module id="demo1-app">
   <template>
 
    <style include="granite-bootstrap"></style>
    <style include = "valo-combo-box" ></style>
    <style include = "valo-grid" ></style>
    <style>



    vaadin-combo-box , vaadin-text-field , vaadin-date-picker{
      width: 100%;
    }

    .card-body{
      padding-top: 0px;
    }

    vaadin-grid{
        height: 670px;
        background-color: #fff;
    }


/** GRID STYLE**/


   
  </style>

  <div class="container">

 <div class="row">



    <div class="col-lg-4 col-md-4 col-sm-12">

      <div class="card border-default" style="width:100%">
        <div class="card-header bg-info text-white" style="padding-top: 15px;padding-bottom: 15px;">Registro de Personas</div>
        <div class="card-body text-primary">
  
        <vaadin-text-field label="Nombres" value = "{{activeItem.nombres}}"></vaadin-text-field>

        <vaadin-text-field label="Apellidos" value = "{{activeItem.apellidos}}"></vaadin-text-field>

        <iron-ajax url="http://asociacionculturalmallas.com/cda/asistencias/api/v1/documentoidentidad" last-response="{{response}}" auto></iron-ajax>
        
        <vaadin-combo-box label="Tipo de documento" placeholder="Seleccione" items="[[response.data]]" item-value-path="id" item-label-path="nombre" value = "{{activeItem.tipo_documento}}" ></vaadin-combo-box>

        <vaadin-text-field value = "{{activeItem.num_documento}}" label="NÃºmero de documento"></vaadin-text-field>  

        <vaadin-date-picker id = "fecNac" label = "Fecha de nacimiento">
        </vaadin-date-picker>

        <vaadin-text-field value = "{{activeItem.email}}" label="Email"></vaadin-text-field>

        <vaadin-text-field value = "{{activeItem.telefono}}" label="Telefono"></vaadin-text-field>

      <vaadin-progress-bar indeterminate value="0"></vaadin-progress-bar>

        <div style="width: 100%;text-align: center; margin-top: 10px;">
          <vaadin-button on-tap = "registro" id = "btnRegistro" class = "bg-primary text-white" >{{actionTitlePersona}}</vaadin-button>
        </div>
        </div>
      </div>

    </div>
    <div class="col-lg-8 col-md-8 col-sm-12">


    <iron-ajax auto url="http://asociacionculturalmallas.com/cda/asistencias/api/v1/personas" handle-as="json" last-response="{{personas}}"></iron-ajax>

    <vaadin-grid id="grid" theme="row-dividers" items="[[personas.data]]" active-item="{{activeItem}}" column-reordering-allowed multi-sort>


      <vaadin-grid-column width = "300px">
        <template class="header">
          <vaadin-grid-sorter path="nombres">Nombre</vaadin-grid-sorter>
        </template>
        <template>[[item.nombres]] [[item.apellidos]]</template>
      </vaadin-grid-column>

      <vaadin-grid-column width = "200px" >
        <template class="header">
          <vaadin-grid-sorter path="num_documento">Documento</vaadin-grid-sorter>
        </template>
        <template>[[item.num_documento_nombre]] : [[item.num_documento]]</template>
      </vaadin-grid-column>

      <vaadin-grid-column width = "250px">
        <template class="header">
          <vaadin-grid-sorter path="email">Email</vaadin-grid-sorter>
        </template>
        <template>[[item.email]]</template>
      </vaadin-grid-column>

       <vaadin-grid-column width = "150px">
        <template class="header">
          <vaadin-grid-sorter path="email">Telefono</vaadin-grid-sorter>
        </template>
        <template>[[item.telefono]]</template>
      </vaadin-grid-column>

       <vaadin-grid-column width = "200px">
        <template class="header">
          <vaadin-grid-sorter path="email">Fec. Nacimiento</vaadin-grid-sorter>
        </template>
        <template>[[item.fec_nacimiento]]</template>
      </vaadin-grid-column>

    </vaadin-grid>


    </div>
  </div>

   

   </div> 
  </template>

  <script>
    /**
     * @customElement
     * @polymer
     */
    class Demo1App extends Polymer.Element {
      static get is() { return 'demo1-app'; }
      static get properties() {
        return {
          formatFecNacimiento: {
            type: String,
            value: ''
          },
          actionTitlePersona: {
            type: String,
            value: 'Registrar'
          },
          activeItem: {
          observer: '_activeItemChanged'
        }
        };
      }

      _activeItemChanged(item) {
        this.$.grid.selectedItems = item ? [item] : [];
        if(item){
          this.actionTitlePersona = 'Actualizar';
          if(item.fec_nacimiento){
            let fec = new Date(item.fec_nacimiento);
            this.$.fecNac.value = moment(fec).format("YYYY-MM-DD");
          }else{
             this.$.fecNac.value = '';
          }
        }else{
            this.actionTitlePersona = 'Registrar';
        }
      }

      registro(){
        console.log(this.activeItem);
        this.$.btnRegistro.disabled = true;
      }

    }

    window.customElements.define(Demo1App.is, Demo1App);
  </script>
</dom-module>
